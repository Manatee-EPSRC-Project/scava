<project default="main">

	<!-- Copies all jars from o.e.s.c.runtime.dependencies here and runs Thrift -->

	<condition property="is-mac">
		<os family="mac" />
	</condition>

	<condition property="is-windows">
		<os family="windows" />
	</condition>

	<target name="mac-init" if="is-mac">
		<property name="thrift" value="/usr/local/bin/thrift" />
	</target>

	<target name="windows-init" if="is-windows">
		<property name="thrift" value="c:\tools\thrift\thrift" />
	</target>

	<target name="main" depends="mac-init, windows-init">

		<!-- before copying dependencies, delete previously copied dependencies to avoid eventual conflicts -->
		<!--	<delete>
			<fileset dir="WebContent/WEB-INF/lib/">
				<include name="*" />
			</fileset>
		</delete> -->

		<copy todir="WebContent/WEB-INF/lib/">
			<fileset dir="../org.eclipse.scava.crossflow.runtime.dependencies/lib" includes="*.jar" />
		</copy>

		<exec executable="${thrift}">
			<arg value="--gen" />
			<arg value="java" />
			<arg value="-out" />
			<arg value="src-gen" />
			<arg value="crossflow.thrift" />
		</exec>

		<exec executable="${thrift}">
			<arg value="--gen" />
			<arg value="js" />
			<arg value="-out" />
			<arg value="WebContent/js/gen" />
			<arg value="crossflow.thrift" />
		</exec>

		<jar destfile="WebContent/WEB-INF/lib/org.eclipse.scava.crossflow.runtime.jar">
			<fileset dir="../org.eclipse.scava.crossflow.runtime/bin" />
		</jar>

		<eclipse.refreshLocal resource="org.eclipse.scava.crossflow.web" depth="-1" />

	</target>

</project>